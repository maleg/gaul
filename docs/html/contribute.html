<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML>
<HEAD>
<TITLE>How to contribute</TITLE>
</HEAD>
<BODY>

<TABLE BORDER="0" WIDTH="95%" ALIGN="center">
 <TR>
  <TD>
   <P ALIGN="center"><IMG SRC="pics/headers/howtocontribute.gif" BORDER="0" ALT="How to contribute"></P>

   <OL type=I>
    <LI><A HREF="#jobs">What needs to be done - How you can help.</A><BR>
    <LI><A HREF="#diff">How to create patches using "diff".</A><BR>
    <LI><A HREF="#Submit">How to submit patches to the gaul-devel mailing list.</A><BR>
    <LI><A HREF="#patch">How to use the patch command.</A><BR>
    <LI><A HREF="#SetupCVS">How to setup CVS.</A><BR>
    <LI><A HREF="#MoreCVS">More things you can do with CVS.</A><BR>
    <LI><A HREF="#Authors">Authors</A>
   </OL>

   <A NAME="jobs"></A>
   <P><HR noshade>
   I) How you can help.
   <HR noshade>

   <P>Besides bug fixes, there are a number of areas in which you may immediately help.  These are listed in the CVS file gaul-devel/docs/jobs.

   <A NAME="diff"></A>
   <P><HR noshade>
   I) How to create patches using "diff".
   <HR noshade>

   <P>This section describes how to create patches using the GNU version of "diff".
   <I>It is also possible to create patches using CVS; see section 
   V.</I>  Following these instruction will make incorporating your patch into the main CVS tree easy, so please read them even if you consider yourself an expert diff user.

   <OL>
    <LI>Make sure your patch is made against the latest version of the 
        source code you can possibly get <I>preferably from CVS or a CVS 
	snapshot</I>.<P>

    <LI>Be sure to indicate exactly which version of the source code your 
        patch should be applied to <I>e.g., "CVS snapshot from 
        September 1"</I>.<P>

    <LI>There are several different "diff" formats but for contributing to GAUL, please choose
        the unified diff format <I>"diff -u"</I>

    <LI>You need a copy of the original file(s) as well as your modified
        file(s).  If you've forgotten to make a copy of the original 
        source code file(s) you've modified, before you modified them, 
	then you'll need to re-extract them or re-download them.  <I>See 
	also the sections on CVS.</I><P>

    <LI>Be sure to specify the original file(s) first, and the modified 
        file(s) second.  Otherwise your diffs will be "backwards".<P>

    <LI>If you've only modified 1 file, or a small number of files <I>all
        in the same directory</I>, then you can run diff against the file(s)
	individually, concatenating them if necessary:

	<PRE>
    % diff -u original_file modified_file &gt;&gt; my_patch</PRE>

	In this case, the "modified_file" should be the normal name of 
	the file in question -- for example,

	<PRE>
    % diff -u unithand.c.orig unithand.c &gt;&gt; my_patch       # RIGHT</PRE>

	Don't do this:

	<PRE>
    % diff -u unithand.c unithand.c.modified &gt;&gt; my_patch   # WRONG!</PRE>

	because that will confuse the program/person applying the 
	patch.

	<P>Please use concatenation only when all the files are in a
	single directory, otherwise the person applying the patch will
	have to break the patch into single-directory pieces.<P>

    <LI>If you've modified several files, it's probably best to let diff 
        find them all for you.  In this case, you'll want to completely 
	separate directory trees -- one with the original code, and one 
	with your modified version.  Then you can use the "recursive" 
	option to diff:

	<PRE>
    % diff -r -u original_directory modified_directory &gt; my_patch</PRE>

	When you do this, you'll want to make sure there aren't any 
	object files or programs in these directories -- if there are, 
	then diff will include references to them in the patch it 
	creates. In that  case, either remove those files and rerun the 
	diff, or edit the  references out of the patch file 
	<I>see below</I>.

	<P>It is also best to specify only short, relative paths to the
	"diff -r" command.  Using long and/or absolute paths just makes
	it harder to apply the patch.  For example, do this:

	<PRE>
    % diff -r -u orig_dir mod_dir &gt; my_patch                  # RIGHT</PRE>

	Instead of this:

	<PRE>
    % diff -r -u prj/orig/fc prj/mods/fc &gt; my_patch           # WRONG!</PRE>

	Especially, don't do this:

	<PRE>
    % diff -r -u /home/me/orig_fc /home/me/mod_fc &gt; my_patch  # WRONG!</PRE>

    <LI>If you've created new files, or deleted or renamed files, then 
        there are some special options you may have to feed to diff -- 
	check the docs.  If a file <CODE>foo</CODE> exists in your
	original_directory and you want it to be copied in your modified
	directory do:

	<PRE>
    % diff -Nur original_directory modified_directory &gt; my_patch</PRE>

	If you use the -N flag you must be especially careful that the 
	patch does not include more new files than you intend; see the
	next point.<P>

    <LI>Often you want files to be ignored in both directories. Binary 
        files or output files or whatever files can be ignored.  Use the 
	command:

	<PRE>
    % diff -Nur -Xdiff.ignore original_directory modified_directory &gt; my_patch</PRE>

	<P>All the files matching the names specified in the diff.ignore file will be skipped.

    <LI>After generating the patch file, *read it*.  Make sure it looks
        sane.  You can use a text editor to correct filenames, or to 
	remove "Binary files differ" and "Only in" lines.  And, please 
	apply it, rebuild, and the execute examples to check that everything
        still works.
	<I>See section III for how to apply the patch.</I><P>

    <LI>Small patches are much easier to integrate than big ones. If you 
        have a big patch try to split it into several little ones.<P>

    <LI>See the next section for how to submit patches.
   </OL>

   <P>As an example, suppose you have two directories: <CODE>gaul-devel</CODE>,
   which contains a snapshot of the CVS repository, and <CODE>gaul-devel-modified</CODE>,
   which contains your working copy. And, you have made a small change
   to your copy. From the directory that
   contains <CODE>gaul-devel</CODE> and <CODE>gaul-devel-modified</CODE>,
   you could use the following to create a patch:

   <PRE>
   % diff -Nur -Xgaul-devel/diff.ignore gaul-devel gaul-devel-modified &gt; bad_bug_fixed.diff
   </PRE>

   See <I>section V</I> for a way to create this patch using CVS.

   <A NAME="Submit"></A>
   <P><HR noshade>
   II) How to submit patches to the gaul-devel mailing list.
   <HR noshade>

   <P>This section describes how to submit patches to the GAUL developers
   mailing list (<A HREF="mailto:gaul-devel@lists.sourceforge.net">gaul-devel@lists.sourceforge.net</A>).

   <UL>
    <LI>You should send email to
	<A HREF="mailto:gaul-devel@lists.sourceforge.net">gaul-devel@lists.sourceforge.net</A>
	describing the purpose of your patch.<P>

    <LI>All files submitted to freeciv-dev in email messages should be
	included as MIME attachments.  (Alternatively you may include
	them "uuencoded".) Otherwise there may be changes to spaces,
	newlines, tabs, etc., which may cause problems for anyone trying
	to apply your patch.<P>

    <LI>If your patch is smaller than approximately 30k, then you should
	simply include it in your email as a text attachment, leaving
	it uncompressed so that people can read it more easily.
	<BR><I>E.g., GW writes: I'm far more likely to take the time
	to look at a patch if it's small, easy to understand, and not
	compressed. If I have to save it in a file and gunzip it, it's
	more likely I'll just wait for someone else to put it in CVS,
	though I might respond to plain-text comments describing the
	patch if I find them interesting.</I>
	<BR><B>Note:</B> Though uncompressed text attachments may
	be more easily read, they are susceptible to being corrupted
	in transit. If this happens, some people may to ask you to
	re-send the patch to them as a gzipped, binary attachment.<P>

    <LI>If your patch is larger than approximately 30k, then you should 
	compress it using "gzip", and include it in your email as a
	binary attachment.<P>

   </UL>

   <A NAME="patch"></A>
   <HR noshade>
   III) How to use the patch command.
   <HR noshade>

   <P>Once you start creating patches you should also learn to use 
   "patch", which applies patches.  There is a GNU version of "patch", 
   and there are some commercial-Unix versions of varying quality.  
   <BR>The GNU version is the best, of course.  This will help to test 
   and manage your own patches, and also let you apply patches from 
   other people.

   <P>For further information, see the patch man page.

   <A NAME="SetupCVS"></A>
   <P><HR noshade>
   IV) How to setup CVS.
   <HR noshade>

   <OL>
    <LI>Obtain, compile and install cvs on your Unix machine. You can 
        get cvs from Cyclic Software at
	<A HREF="http://www.cyclic.com/">http://www.cyclic.com/</A>.<P>

    <LI>Set your CVSROOT environment variable: 

        <P>If you're using Bourne shell, do it like this: 

	<PRE>
    % CVSROOT=:pserver:freecvs@cvs.freeciv.org:/home/freeciv/CVS
    % export CVSROOT</PRE>

	Your shell might allow you to combine these two lines like this:
    
        <PRE>
    % export CVSROOT=:pserver:freecvs@cvs.freeciv.org:/home/freeciv/CVS</PRE>

	If you're using C shell, do it like this: 

	<PRE>
    % setenv CVSROOT :pserver:freecvs@cvs.freeciv.org:/home/freeciv/CVS</PRE>

    <LI>Tell the cvs server who you are: 

        <PRE>
    % cvs login     <I>the password is:</I> <B>freecvs</B></PRE>

    <LI>Grab yourself the source! <I>Note, do this once only</I>:

        <PRE>
    % cvs co freeciv</PRE>

	If you want to receive further updates, cd into the freeciv 
	directory, then use cvs update -d.<P>

    <LI>Also, to speed things up over a network, add a -z3 flag 
        immediately after the cvs command. This causes all network 
	traffic to be compressed. 
   </OL>

   <A NAME="MoreCVS"></A>
   <HR noshade>
   V) More things you can do with CVS.
   <HR noshade> 

   <OL>
    <LI>If you want to see what differs between your version and the 
        cvs version, use <BR>"cvs diff -u" in your freeciv directory.
	<P>For example, to create the same patch we did as an example
	in <I>section I</I>, change the current working directory to
	freeciv-mod (where your modified source lives), and do:

	<PRE>
    % cvs diff -u &gt; /tmp/barb_comment_cvs.diff
	</PRE>

    <LI>To get the list of comments which has been added for each 
        revision of the file foo.c use <BR>"cvs log foo.c".<P>

    <LI>To get the status of file foo.c use <BR>"cvs status foo.c".
        Here you can read the revision number of the file on your hard 
	disk and the revision number of the file in the repository on
        sourceforge.

    <LI>If you want to see what changes has been made in foo.c, use
        <BR>"cvs diff -rr1 -rr2 foo.c" where r1 and r2 are two revision 
	numbers.

    <LI>If you want to use a previous revision of the file foo.c do
        <BR>"cvs up -rr1 foo.c". For example:

    <LI>If you don't want to have your CVS copy of gaul-devel in a dir 
        called gaul-devel, use <BR>"cvs co -d my_dir gaul-devel".<P>

   </OL>

   <A NAME="Authors"></A>
   <HR noshade>
   VIII) Authors.
   <HR noshade>

   <p>This document was based on the equivalent freeciv file, with GAUL specifics added by Stewart Adcock.

   <P>Contributions to that original document were made by:

   <P>Mitch Davis <A HREF="mailto:mjd@aus.hp.com">mjd@aus.hp.com</A>
   <BR>Greg Wooledge <A HREF="mailto:wooledge@kellnet.com">wooledge@kellnet.com</A>
   <BR>Nicolas Brunel <A HREF="mailto:brunel@ham.esil.univ-mrs.fr">brunel@ham.esil.univ-mrs.fr</A>
   <BR>David Pfitzner <A HREF="mailto:dwp@mso.anu.edu.au">dwp@mso.anu.edu.au</A>
   <BR>Jeff Mallatt <A HREF="mailto:jjm@codewell.com">jjm@codewell.com</A>
   <BR>Martin Willemoes Hansen <A HREF="mailto:mwh@stampede.org">mwh@stampede.org</A> <I>HTML converting</I>
   
  </TD>
 </TR>
</TABLE>

</BODY>
</HTML>
